<?xml version="1.0" encoding="utf-8"?>
<procedure>
  <database>cob_bvirtual</database>
  <name>sp_cons_login_bv</name>
  <type>SQLSERVER</type>
  <version>1</version>
  <parameters>
    <parameter name="@t_show_version" dataType="bit" direction="in" />
    <parameter name="@s_user" dataType="varchar" direction="in" />
    <parameter name="@s_date" dataType="datetime" direction="in" />
    <parameter name="@s_srv" dataType="varchar" direction="in" />
    <parameter name="@s_ofi" dataType="smallint" direction="in" />
    <parameter name="@s_term" dataType="varchar" direction="in" />
    <parameter name="@s_culture" dataType="varchar" direction="in" />
    <parameter name="@i_operacion" dataType="char" direction="in" />
    <parameter name="@i_modo" dataType="tinyint" direction="in" />
    <parameter name="@i_valor" dataType="varchar" direction="in" />
    <parameter name="@i_cliente" dataType="int" direction="in" />
    <parameter name="@i_cod_grp" dataType="int" direction="in" />
    <parameter name="@i_tipo_ente" dataType="char" direction="in" />
    <parameter name="@i_servicio" dataType="tinyint" direction="in" />
    <parameter name="@i_formato_fecha" dataType="tinyint" direction="in" />
    <parameter name="@i_buscatodos" dataType="varchar" direction="in" />
    <parameter name="@i_tipo_clave" dataType="char" direction="in" />
    <parameter name="@i_login" dataType="varchar" direction="in" />
    <parameter name="@o_num_filas" dataType="tinyint" direction="out" />
    <parameter name="@s_cliente" dataType="int" direction="in" />
    <parameter name="@s_culture" dataType="varchar" direction="in" />
    <parameter name="@t_trn" dataType="int" direction="in" />
    <parameter name="@i_max_trx_retry" dataType="int" direction="in" />
    <parameter name="@i_message" dataType="varchar" direction="in" />
    <parameter name="@i_resultado" dataType="bit" direction="in" />
    <parameter name="@i_firma_id" dataType="bit" direction="in" />
  </parameters>
  <queries>
    <query>
      <columns>
        <column name="{1}" />
      </columns>
      <queryText>SELECT o_num_filas</queryText>
    </query>
    <query>
      <columns>
        <column name="CANAL" />
        <column name="CANAL DESCR." />
        <column name="LOGIN" />
        <column name="DESCRIP/USR" />
        <column name="FEC.INGR." />
        <column name="FEC.ULT.MOD" />
        <column name="# CONT. GEN" />
        <column name="# CONT. IMP" />
        <column name="VIGENCIA" />
        <column name="VIGENCIA DESCR." />
        <column name="DIAS VIGENCIA" />
        <column name="PARAMETRO" />
        <column name="PARAMETRO DESCR." />
        <column name="RENOV." />
        <column name="TIPO_AUT" />
        <column name="ESTADO" />
        <column name="AUTORIZADO" />
        <column name="MOTIVO REIMP" />
        <column name="MOTIVO REIMP DESCR" />
        <column name="EMPRESA" />
        <column name="DESC. EMPRESA" />
        <column name="CULTURA" />
        <column name="CULTURA DESC." />
        <column name="AUTENTICACION" />
        <column name="NUM. TOKEN" />
      </columns>
      <queryText>SELECT  "CANAL" = lo_servicio,"CANAL DESCR." = se_nombre,"LOGIN" = lo_login,"DESCRIP/USR" = SUBSTRING (lo_descripcion, 1, 32),"FEC.INGR." = CONVERT (VARCHAR (10),lo_fecha_reg ,?),"FEC.ULT.MOD" = CONVERT (VARCHAR (10),lo_fecha_mod ,?),"# CONT. GEN" = lo_clave_gen,"# CONT. IMP" = lo_clave_imp,"VIGENCIA" = lo_tipo_vigencia,"VIGENCIA DESCR." = SUBSTRING (b.valor, 1, 32),"DIAS VIGENCIA" = lo_dias_vigencia,"PARAMETRO" = lo_parametro,"PARAMETRO DESCR." = SUBSTRING (m.pa_parametro, 1, 32),"RENOV." = lo_renovable,"TIPO_AUT" = lo_tipo_autorizacion,"ESTADO" = lo_estado,"AUTORIZADO" = lo_autorizado,"MOTIVO REIMP" = lo_motivo_reimp,"MOTIVO REIMP DESCR" = (SELECT  p.valor FROM cobis..cl_tabla l  ,cobis..cl_catalogo p   WHERE l.tabla = "bv_motivo_reimpresion" AND l.codigo = p.tabla AND p.codigo = lo_motivo_reimp AND p.estado = "V"     ),"EMPRESA" = lo_empresa,"DESC. EMPRESA" = (SELECT  cg_cliente FROM cob_bvirtual..bv_ente  ,cob_bvirtual..bv_cliente_grupo   WHERE en_ente = l.lo_ente AND en_ente_mis = cg_grupo AND cg_cod_cliente = l.lo_empresa     ),"CULTURA" = lo_cultura,"CULTURA DESC." = (SELECT  cob_bvirtual..CAT_CUL.valor FROM cobis..cl_tabla TAB_CUL  ,cobis..cl_catalogo CAT_CUL   WHERE cob_bvirtual..TAB_CUL.codigo = cob_bvirtual..CAT_CUL.tabla AND cob_bvirtual..TAB_CUL.tabla = "bv_cultura" AND cob_bvirtual..CAT_CUL.codigo = lo_cultura AND cob_bvirtual..CAT_CUL.estado = "V"     ),"AUTENTICACION" = (SELECT  la_trx_auth_type FROM cob_bvirtual..bv_login_authentication   WHERE la_login = lo_login     ),"NUM. TOKEN" = (SELECT  la_trx_serial_number FROM cob_bvirtual..bv_login_authentication   WHERE la_login = lo_login     ) </queryText>
    </query>
    <query>
      <columns>
        <column name="CANAL" />
        <column name="CANAL DESCR." />
        <column name="LOGIN" />
        <column name="DESCRIP/USR" />
        <column name="FEC.INGR." />
        <column name="FEC. ULT. MOD" />
        <column name="# CONT. GEN" />
        <column name="# CONT. IMP" />
        <column name="VIGENCIA" />
        <column name="VIGENCIA DESCR." />
        <column name="DIAS VIGENCIA" />
        <column name="PARAMETRO" />
        <column name="PARAMETRO DESCR." />
        <column name="RENOV." />
        <column name="TIPO_AUT" />
        <column name="ESTADO" />
        <column name="AUTORIZADO" />
        <column name="MOTIVO REIMP" />
        <column name="MOTIVO REIMP DESCR" />
        <column name="EMPRESA" />
        <column name="DESC. EMPRESA" />
        <column name="CULTURA" />
        <column name="CULTURA DESC." />
        <column name="AUTENTICACION" />
        <column name="NUM. TOKEN" />
      </columns>
      <queryText>SELECT  "CANAL" = lo_servicio,"CANAL DESCR." = se_nombre,"LOGIN" = lo_login,"DESCRIP/USR" = SUBSTRING (lo_descripcion, 1, 32),"FEC.INGR." = CONVERT (VARCHAR (10),lo_fecha_reg ,?),"FEC. ULT. MOD" = CONVERT (VARCHAR (10),lo_fecha_mod ,?),"# CONT. GEN" = lo_clave_gen,"# CONT. IMP" = lo_clave_imp,"VIGENCIA" = lo_tipo_vigencia,"VIGENCIA DESCR." = SUBSTRING (b.valor, 1, 32),"DIAS VIGENCIA" = lo_dias_vigencia,"PARAMETRO" = lo_parametro,"PARAMETRO DESCR." = SUBSTRING (m.pa_parametro, 1, 32),"RENOV." = lo_renovable,"TIPO_AUT" = lo_tipo_autorizacion,"ESTADO" = lo_estado,"AUTORIZADO" = lo_autorizado,"MOTIVO REIMP" = lo_motivo_reimp,"MOTIVO REIMP DESCR" = (SELECT  p.valor FROM cobis..cl_tabla l  ,cobis..cl_catalogo p   WHERE l.tabla = "bv_motivo_reimpresion" AND l.codigo = p.tabla AND p.codigo = lo_motivo_reimp AND p.estado = "V"     ),"EMPRESA" = lo_empresa,"DESC. EMPRESA" = (SELECT  cg_cliente FROM cob_bvirtual..bv_ente  ,cob_bvirtual..bv_cliente_grupo   WHERE en_ente = l.lo_ente AND en_ente_mis = cg_grupo AND cg_cod_cliente = l.lo_empresa     ),"CULTURA" = lo_cultura,"CULTURA DESC." = (SELECT  cob_bvirtual..CAT_CUL.valor FROM cobis..cl_tabla TAB_CUL  ,cobis..cl_catalogo CAT_CUL   WHERE cob_bvirtual..TAB_CUL.codigo = cob_bvirtual..CAT_CUL.tabla AND cob_bvirtual..TAB_CUL.tabla = "bv_cultura" AND cob_bvirtual..CAT_CUL.codigo = lo_cultura AND cob_bvirtual..CAT_CUL.estado = "V"     ),"AUTENTICACION" = (SELECT  la_trx_auth_type FROM cob_bvirtual..bv_login_authentication   WHERE la_login = lo_login     ),"NUM. TOKEN" = (SELECT  la_trx_serial_number FROM cob_bvirtual..bv_login_authentication   WHERE la_login = lo_login     ) </queryText>
    </query>
    <query>
      <columns>
        <column name="CANAL" />
        <column name="ESTADO" />
        <column name="LOGIN" />
        <column name="DESCRIP/USR" />
        <column name="FEC.INGRESO" />
        <column name="FEC.ULT.MOD" />
        <column name="VIGENCIA" />
        <column name="VIGENCIA DESCR." />
        <column name="DIAS VIGENCIA" />
        <column name="PARAMETRO" />
        <column name="PARAMETRO DESCR." />
        <column name="RENOV." />
        <column name="AUTORIZADO" />
      </columns>
      <queryText>SELECT  "CANAL" = lo_servicio,"ESTADO" = lo_estado,"LOGIN" = lo_login,"DESCRIP/USR" = SUBSTRING (lo_descripcion, 1, 32),"FEC.INGRESO" = CONVERT (VARCHAR (10),lo_fecha_reg ,?),"FEC.ULT.MOD" = CONVERT (VARCHAR (10),lo_fecha_mod ,?),"VIGENCIA" = lo_tipo_vigencia,"VIGENCIA DESCR." = SUBSTRING (b.valor, 1, 32),"DIAS VIGENCIA" = lo_dias_vigencia,"PARAMETRO" = lo_parametro,"PARAMETRO DESCR." = SUBSTRING (m.pa_parametro, 1, 32),"RENOV." = lo_renovable,"AUTORIZADO" = lo_autorizado </queryText>
    </query>
    <query>
      <columns>
        <column name="CANAL" />
        <column name="ESTADO" />
        <column name="LOGIN" />
        <column name="DESCRIP/USR" />
        <column name="FEC.INGRESO" />
        <column name="FEC.ULT.MOD" />
        <column name="VIGENCIA" />
        <column name="VIGENCIA DESCR." />
        <column name="DIAS VIGENCIA" />
        <column name="PARAMETRO" />
        <column name="PARAMETRO DESCR." />
        <column name="RENOV." />
        <column name="AUTORIZADO" />
      </columns>
      <queryText>SELECT  "CANAL" = lo_servicio,"ESTADO" = lo_estado,"LOGIN" = lo_login,"DESCRIP/USR" = SUBSTRING (lo_descripcion, 1, 32),"FEC.INGRESO" = CONVERT (VARCHAR (10),lo_fecha_reg ,?),"FEC.ULT.MOD" = CONVERT (VARCHAR (10),lo_fecha_mod ,?),"VIGENCIA" = lo_tipo_vigencia,"VIGENCIA DESCR." = SUBSTRING (b.valor, 1, 32),"DIAS VIGENCIA" = lo_dias_vigencia,"PARAMETRO" = lo_parametro,"PARAMETRO DESCR." = SUBSTRING (m.pa_parametro, 1, 32),"RENOV." = lo_renovable,"AUTORIZADO" = lo_autorizado </queryText>
    </query>
    <query>
      <columns>
        <column name="{1}" />
      </columns>
      <queryText>SELECT w_login_descr</queryText>
    </query>
    <query>
      <columns>
        <column name="{1}" />
      </columns>
      <queryText>SELECT w_login_descr</queryText>
    </query>
    <query>
      <columns>
        <column name="CANAL" />
        <column name="CANAL DESCR." />
        <column name="LOGIN" />
        <column name="DESCRIP/USR" />
        <column name="FEC.INGR." />
        <column name="FEC.ULT.MOD" />
        <column name="VIGENCIA" />
        <column name="VIGENCIA DESCR." />
        <column name="DIAS VIGENCIA" />
        <column name="PARAMETRO" />
        <column name="PARAMETRO DESCR." />
        <column name="RENOV." />
        <column name="TIPO_AUT" />
        <column name="ESTADO" />
        <column name="AUTORIZADO" />
        <column name="ENTE" />
      </columns>
      <queryText>SELECT  "CANAL" = lo_servicio,"CANAL DESCR." = se_nombre,"LOGIN" = lo_login,"DESCRIP/USR" = SUBSTRING (lo_descripcion, 1, 32),"FEC.INGR." = CONVERT (VARCHAR (10),lo_fecha_reg ,?),"FEC.ULT.MOD" = CONVERT (VARCHAR (10),lo_fecha_mod ,?),"VIGENCIA" = lo_tipo_vigencia,"VIGENCIA DESCR." = SUBSTRING (b.valor, 1, 32),"DIAS VIGENCIA" = lo_dias_vigencia,"PARAMETRO" = lo_parametro,"PARAMETRO DESCR." = SUBSTRING (m.pa_parametro, 1, 32),"RENOV." = lo_renovable,"TIPO_AUT" = lo_tipo_autorizacion,"ESTADO" = lo_estado,"AUTORIZADO" = lo_autorizado,"ENTE" = lo_ente </queryText>
    </query>
    <query>
      <columns>
        <column name="CANAL" />
        <column name="CANAL DESCR." />
        <column name="LOGIN" />
        <column name="DESCRIP/USR" />
        <column name="FEC.INGR." />
        <column name="FEC.ULT.MOD" />
        <column name="VIGENCIA" />
        <column name="VIGENCIA DESCR." />
        <column name="DIAS VIGENCIA" />
        <column name="PARAMETRO" />
        <column name="PARAMETRO DESCR." />
        <column name="RENOV." />
        <column name="TIPO_AUT" />
        <column name="ESTADO" />
        <column name="AUTORIZADO" />
        <column name="ENTE" />
      </columns>
      <queryText>SELECT  "CANAL" = lo_servicio,"CANAL DESCR." = se_nombre,"LOGIN" = lo_login,"DESCRIP/USR" = SUBSTRING (lo_descripcion, 1, 32),"FEC.INGR." = CONVERT (VARCHAR (10),lo_fecha_reg ,?),"FEC.ULT.MOD" = CONVERT (VARCHAR (10),lo_fecha_mod ,?),"VIGENCIA" = lo_tipo_vigencia,"VIGENCIA DESCR." = SUBSTRING (b.valor, 1, 32),"DIAS VIGENCIA" = lo_dias_vigencia,"PARAMETRO" = lo_parametro,"PARAMETRO DESCR." = SUBSTRING (m.pa_parametro, 1, 32),"RENOV." = lo_renovable,"TIPO_AUT" = lo_tipo_autorizacion,"ESTADO" = lo_estado,"AUTORIZADO" = lo_autorizado,"ENTE" = lo_ente </queryText>
    </query>
    <query>
      <columns>
        <column name="CANAL" />
        <column name="CANAL DESCR." />
        <column name="LOGIN" />
        <column name="DESCRIP/USR" />
        <column name="FEC. INGRESO" />
        <column name="FEC. ULT. MOD" />
        <column name="VIGENCIA" />
        <column name="VIGENCIA DESCR." />
        <column name="DIAS VIGENCIA" />
        <column name="PARAMETRO" />
        <column name="PARAMETRO DESCR." />
        <column name="RENOV." />
        <column name="TIPO_AUT" />
        <column name="AUTORIZADO" />
        <column name="ENTE" />
      </columns>
      <queryText>SELECT  "CANAL" = lo_servicio,"CANAL DESCR." = se_nombre,"LOGIN" = lo_login,"DESCRIP/USR" = SUBSTRING (lo_descripcion, 1, 32),"FEC. INGRESO" = CONVERT (VARCHAR (10),lo_fecha_reg ,?),"FEC. ULT. MOD" = CONVERT (VARCHAR (10),lo_fecha_mod ,?),"VIGENCIA" = lo_tipo_vigencia,"VIGENCIA DESCR." = SUBSTRING (b.valor, 1, 32),"DIAS VIGENCIA" = lo_dias_vigencia,"PARAMETRO" = lo_parametro,"PARAMETRO DESCR." = SUBSTRING (m.pa_parametro, 1, 32),"RENOV." = lo_renovable,"TIPO_AUT" = lo_tipo_autorizacion,"AUTORIZADO" = lo_autorizado,"ENTE" = lo_ente </queryText>
    </query>
    <query>
      <columns>
        <column name="CANAL" />
        <column name="CANAL DESCR." />
        <column name="LOGIN" />
        <column name="DESCRIP/USR" />
        <column name="FEC. INGRESO" />
        <column name="FEC. ULT. MOD" />
        <column name="VIGENCIA" />
        <column name="VIGENCIA DESCR." />
        <column name="DIAS VIGENCIA" />
        <column name="PARAMETRO" />
        <column name="PARAMETRO DESCR." />
        <column name="RENOV." />
        <column name="TIPO_AUT" />
        <column name="AUTORIZADO" />
        <column name="ENTE" />
      </columns>
      <queryText>SELECT  "CANAL" = lo_servicio,"CANAL DESCR." = se_nombre,"LOGIN" = lo_login,"DESCRIP/USR" = SUBSTRING (lo_descripcion, 1, 32),"FEC. INGRESO" = CONVERT (VARCHAR (10),lo_fecha_reg ,?),"FEC. ULT. MOD" = CONVERT (VARCHAR (10),lo_fecha_mod ,?),"VIGENCIA" = lo_tipo_vigencia,"VIGENCIA DESCR." = SUBSTRING (b.valor, 1, 32),"DIAS VIGENCIA" = lo_dias_vigencia,"PARAMETRO" = lo_parametro,"PARAMETRO DESCR." = SUBSTRING (m.pa_parametro, 1, 32),"RENOV." = lo_renovable,"TIPO_AUT" = lo_tipo_autorizacion,"AUTORIZADO" = lo_autorizado,"ENTE" = lo_ente </queryText>
    </query>
    <query>
      <columns>
        <column name="{1}" />
      </columns>
      <queryText>SELECT w_autoriz_imp</queryText>
    </query>
    <query>
      <columns>
        <column name="{1}" />
      </columns>
      <queryText>SELECT  pa_char </queryText>
    </query>
    <query>
      <columns>
        <column name="{1}" />
      </columns>
      <queryText>SELECT  ISNULL (MAX (CONVERT (INT,SUBSTRING (lo_login, DATALENGTH (RTRIM (SUBSTRING (lo_login, 1, CHARINDEX ("-", lo_login) - 1))) + 2, 6) )), 1) + 1 </queryText>
    </query>
    <query>
      <columns>
        <column name="{1}" />
      </columns>
      <queryText>SELECT  ISNULL (MAX (CONVERT (INT,SUBSTRING (lo_login, DATALENGTH (RTRIM (SUBSTRING (lo_login, 1, CHARINDEX ("-", lo_login) - 1))) + 2, 6) )), 1) + 1 </queryText>
    </query>
    <query>
      <columns>
        <column name="PROVEEDOR" />
        <column name="AUTENTICACION" />
      </columns>
      <queryText>SELECT  "PROVEEDOR" = la_provider,"AUTENTICACION" = la_trx_auth_type </queryText>
    </query>
  </queries>
</procedure>